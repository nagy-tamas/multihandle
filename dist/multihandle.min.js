"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a){function b(a,b){b||(b=1);var c=1/b;return Math.round(a*c)/c}function c(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}function d(a){var b={};return Object.keys(a).forEach(function(c){b[c]=a[c]}),b}function e(a){return"undefined"!=typeof a.clientX?a.clientX:a.touches[0]?a.touches[0].clientX:void 0}function f(b,c){var d=document.createEvent("HTMLEvents");return"function"==typeof Event?(c=c||{view:a,bubbles:!0,cancelable:!0},new Event(b,c)):(d.initEvent(b,!0,!0),d)}var g=function(){function a(b){var c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,a),this.el=b,this.el.className=b.className.replace(/multihandle--loading/g,""),this.options=this.parseOptions(c),this.dataset=null,this.dragging=!1,this.container=this.el.querySelector(".multihandle__component"),this.container||(this.container=this.el),this.inputs=[],this.handlers=[],this.intervals=[],this.buildComponent(),this.syncHandlersToInputs(),this.syncIntervalsBetweenHandlers(),this.bindEvents()}return _createClass(a,[{key:"parseOptions",value:function(a){var b=Object.assign({min:0,max:100,step:.5,decimalsAccuracy:2,dataset:!1,gfx:"",tplTrack:"${handlers}",tplHandler:"${label}",tplSnappingpoint:"${label}"},d(this.el.dataset),a);return b.gfx=b.gfx.split(","),b.dataset&&(b.min=0,b.step=1),"string"==typeof b.step&&(b.step=parseFloat(b.step,10)),b.incLittle="undefined"==typeof b.incLittle?b.step:b.incLittle,b.incBig="undefined"==typeof b.incBig?10*b.step:b.incBig,b.min=parseFloat(b.min,10),b.max=parseFloat(b.max,10),b.step=parseFloat(b.step,10),b}},{key:"createHandlers",value:function(a){var b=this;return a.reduce(function(a,c){return a+'<a href="javascript:void(0)" class="multihandle__handle">\n          '+b.options.tplHandler+"\n        </a>"},"")}},{key:"createDatasetFromSelect",value:function(a){for(var b=[],c=0;c<=a.options.length-1;c++)b.push({value:a.options[c].value,label:a.options[c].text});return b}},{key:"findInputs",value:function(a){return"select"===this.options.dataset?Array.prototype.slice.call(a.querySelectorAll("select")):Array.prototype.slice.call(a.querySelectorAll("input"))}},{key:"findHandlers",value:function(a){var b=this,c=[];return Array.prototype.forEach.call(a.querySelectorAll(".multihandle__handle"),function(a,d){a.inputReference=b.inputs[d],c.push(a)}),c}},{key:"initDataset",value:function(){"select"===this.options.dataset&&(this.dataset=this.createDatasetFromSelect(this.inputs[0]),this.options.max=this.inputs[0].options.length-1)}},{key:"createIntervals",value:function(a){if(!(this.handlers.length<2))for(var b=0;b<this.handlers.length-1;b++){var c=document.createElement("span");c.className="multihandle__interval multihandle__interval--"+b,c.from=this.handlers[b],c.to=this.handlers[b+1],this.intervals.push(c),a.appendChild(c)}}},{key:"createSnappingPoints",value:function(a){var b=this,c=document.createElement("div");c.className="multihandle__snappingpoints",a.appendChild(c),this.snappingMap.forEach(function(a,d){var e=document.createElement("span"),f=void 0;e.className="multihandle__snappingpoint",c.appendChild(e),f="select"===b.options.dataset?b.dataset[a[0]].label:a[0],e.innerHTML=b.options.tplSnappingpoint.replace(/\${label}/,f),e.style.left=a[1]+"%"})}},{key:"createSnappingMap",value:function(){for(var a=Math.abs(this.options.max-this.options.min),b=a/this.options.step,d=[],e=0;e<=b;e++){var f=c(e*this.options.step,6);d.push([this.options.min+f,c(f/a*100,2)])}return d}},{key:"isItSnaps",value:function(){return 0!==this.options.step}},{key:"setHandlerPos",value:function(a,b){var c=this.percentToValue(b);this.setHandlerLeft(a,b),this.updateHandlerLabel(a,c),this.syncIntervalsBetweenHandlers()}},{key:"setHandlerLeft",value:function(a,b){a.style.left=b+"%"}},{key:"updateHandlerLabel",value:function(a,b){var c=void 0;c="select"===this.options.dataset?this.dataset[b].label:b,a.innerHTML=this.options.tplHandler.replace(/\${label}/,c)}},{key:"buildComponent",value:function(){var a=document.createElement("div");a.className="multihandle__track",this.container.appendChild(a),this.inputs=this.findInputs(this.el),this.options.dataset&&this.initDataset(),a.innerHTML=this.options.tplTrack.replace(/\${handlers}/,this.createHandlers(this.inputs)),this.handlers=this.findHandlers(a),this.createIntervals(a),this.isItSnaps()&&(this.snappingMap=this.createSnappingMap(),this.options.gfx.indexOf("snappingpoints")>-1&&this.createSnappingPoints(a)),this.container.appendChild(a)}},{key:"bindEvents",value:function(){var a=this;this.container.addEventListener("mousedown",function(b){return a.onMouseDown(b)}),this.container.addEventListener("touchstart",function(b){return a.onMouseDown(b)}),document.body.addEventListener("mouseup",function(b){return a.onMouseUp(b)}),document.body.addEventListener("touchend",function(b){return a.onMouseUp(b)}),document.body.addEventListener("touchcancel",function(b){return a.onMouseUp(b)}),document.body.addEventListener("mousemove",function(b){return a.onMouseMove(b)}),document.body.addEventListener("touchmove",function(b){return a.onMouseMove(b)}),this.handlers.forEach(function(b){b.addEventListener("keydown",function(b){return a.onHandlerKeyDown(b)}),b.ondragstart=function(a){return!1}})}},{key:"onMouseDown",value:function(a){var b=this.handlers.indexOf(a.target);b<0||(this.dragging={handlerIx:b,handler:this.handlers[b],startLeft:this.handlers[b].offsetLeft,startX:e(a)},this.dragging.handler.classList.add("multihandle__handle--active"))}},{key:"onMouseUp",value:function(a){this.dragging&&(this.dragging.handler.classList.remove("multihandle__handle--active"),this.dragging.handler.inputReference.dispatchEvent(f("inputend"))),this.dragging=!1}},{key:"onMouseMove",value:function(a){if(this.dragging&&this.dragging.handlerIx>-1){var b=this.dragging.startLeft-(this.dragging.startX-e(a)),c=this.normalizePercent(this.pixelToPercent(b));this.setValueByPercent(this.dragging.handler,c)}}},{key:"setValue",value:function(a,b){b=this.normalizeValue(b);var c=this.valueToPercent(b);"select"===this.options.dataset?a.inputReference.options.selectedIndex=b:a.inputReference.value=b,a.inputReference.dispatchEvent(f("input")),this.setHandlerPos(a,c)}},{key:"setValueByPercent",value:function(a,b){var c=this.percentToValue(b);this.setValue(a,c)}},{key:"onHandlerKeyDown",value:function(a){switch(a.keyCode){case 38:this.incByBig(a.target),a.preventDefault();break;case 40:this.descByBig(a.target),a.preventDefault();break;case 39:this.incByLittle(a.target),a.preventDefault();break;case 37:this.descByLittle(a.target),a.preventDefault()}}},{key:"incDec",value:function(a,b){this.setValue(a,parseFloat(a.inputReference.value,10)+b),a.inputReference.dispatchEvent(f("inputend"))}},{key:"incByLittle",value:function(a){this.incDec(a,this.options.incLittle)}},{key:"descByLittle",value:function(a){this.incDec(a,-this.options.incLittle)}},{key:"incByBig",value:function(a){this.incDec(a,this.options.incBig)}},{key:"descByBig",value:function(a){this.incDec(a,-this.options.incBig)}},{key:"syncHandlersToInputs",value:function(){var a=this;if("select"===this.options.dataset){var b=this.inputs[0].options.selectedIndex,c=this.valueToPercent(b);this.setHandlerPos(this.handlers[0],c)}else!function(){var b=a;b.handlers.forEach(function(a){var c=parseFloat(a.inputReference.value,10),d=b.valueToPercent(c);b.setHandlerPos(a,d)})}()}},{key:"syncIntervalsBetweenHandlers",value:function(){this.handlers.length<2||this.intervals.forEach(function(a){var b=parseFloat(a.to.style.left,10),c=parseFloat(a.from.style.left,10),d=Math.min(b,c),e=Math.abs(b-c);a.style.left=d+"%",a.style.width=e+"%"})}},{key:"valueToPercent",value:function(a){var b=this.options.max-this.options.min;return 100/b*(a-this.options.min)}},{key:"pixelToPercent",value:function(a){var b=this.container.scrollWidth;return a/b*100}},{key:"percentToOffset",value:function(a){var b=this.options.max-this.options.min,c=a/(100/b);return c}},{key:"percentToValue",value:function(a){var c=this.percentToOffset(a)+this.options.min,d=b(c,this.options.step);return d}},{key:"normalizePercent",value:function(a){return a=Math.max(0,a),a=Math.min(100,a),this.valueToPercent(this.percentToValue(a))}},{key:"normalizeValue",value:function(a){return a=Math.max(this.options.min,a),a=Math.min(this.options.max,a),a=c(a,this.options.decimalsAccuracy)}}]),a}(),h=function(a){a instanceof NodeList&&(a=Array.prototype.slice.call(a)),a instanceof Array||(a=[a]),a.forEach(function(a){return new g(a)})};a.Multihandle=g,a.multihandle={init:h}}(window);