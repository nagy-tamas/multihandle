"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a){function b(a,b){b||(b=1);var c=1/b;return Math.round(a*c)/c}function c(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}function d(a){var b={};return Object.keys(a).forEach(function(c){b[c]=a[c]}),b}function e(a){return"undefined"!=typeof a.clientX?a.clientX:a.touches[0]?a.touches[0].clientX:void 0}function f(b,c){var d=document.createEvent("HTMLEvents");return"function"==typeof Event?(c=c||{view:a,bubbles:!0,cancelable:!0},new Event(b,c)):(d.initEvent(b,!0,!0),d)}var g=function(){function a(b){var c=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,a),this.el=b,this.el.className=b.className.replace(/multihandle--loading/g,""),this.options=this.parseOptions(c),this.dataset=null,this.dragging=!1,this.container=this.el.querySelector(".multihandle__component"),this.container||(this.container=this.el),this.handlers=[],this.handlerEls=[],this.intervals=[],this.buildComponent(),this.syncHandlersToInputs(),this.syncIntervalsBetweenHandlers(),this.bindEvents()}return _createClass(a,[{key:"parseOptions",value:function(a){var b=Object.assign({min:0,max:100,step:.5,decimalsAccuracy:2,gfx:"",tpl:{track:"${handlers}",handler:"${value}",snappingpoint:"${value}"}},d(this.el.dataset),a);return b.gfx=b.gfx.split(","),b.dataset=!!b.dataset,b.dataset&&(b.min=0,b.step=1),"string"==typeof b.step&&(b.step=parseFloat(b.step,10)),b.incLittle="undefined"==typeof b.incLittle?b.step:b.incLittle,b.incBig="undefined"==typeof b.incBig?10*b.step:b.incBig,b.min=parseFloat(b.min,10),b.max=parseFloat(b.max,10),b.step=parseFloat(b.step,10),console.log(b),b}},{key:"createHandlers",value:function(){var a=this;return this.handlers.reduce(function(b,c){return b+'<a href="javascript:void(0)" class="multihandle__handle">\n          '+a.options.tpl.handler+"\n        </a>"},"")}},{key:"createDataset",value:function(a){for(var b=[],c=0;c<=a.options.length-1;c++)b.push({value:a.options[c].value,label:a.options[c].text});return b}},{key:"findInputs",value:function(){this.options.dataset?(this.handlers=Array.prototype.slice.call(this.el.querySelectorAll("select")),this.dataset=this.createDataset(this.handlers[0]),this.options.max=this.handlers[0].options.length-1):this.handlers=Array.prototype.slice.call(this.el.querySelectorAll("input"))}},{key:"findHandlers",value:function(a){var b=this,c=this;Array.prototype.forEach.call(a.querySelectorAll(".multihandle__handle"),function(a,d){a.inputReference=b.handlers[d],c.handlerEls.push(a)})}},{key:"createIntervals",value:function(a){if(!(this.handlerEls.length<2))for(var b=0;b<this.handlerEls.length-1;b++){var c=document.createElement("span");c.className="multihandle__interval multihandle__interval--"+b,c.from=this.handlerEls[b],c.to=this.handlerEls[b+1],this.intervals.push(c),a.appendChild(c)}}},{key:"createSnappingPoints",value:function(a){var b=this,c=document.createElement("div");c.className="multihandle__snappingpoints",a.appendChild(c),this.snappingMap.forEach(function(a,d){var e=document.createElement("span");e.className="multihandle__snappingpoint",c.appendChild(e),e.innerHTML=b.options.tpl.snappingpoint.replace(/\${value}/,a[0]),e.style.left=a[1]+"%"})}},{key:"createSnappingMap",value:function(){for(var a=Math.abs(this.options.max-this.options.min),b=a/this.options.step,d=[],e=0;e<=b;e++){var f=c(e*this.options.step,6);d.push([this.options.min+f,c(f/a*100,2)])}return d}},{key:"isItSnaps",value:function(){return 0!==this.options.step}},{key:"setHandlerPos",value:function(a,b){var c=this.percentToValue(b);a.style.left=b+"%",a.innerHTML=this.options.tpl.handler.replace(/\${value}/,c),this.syncIntervalsBetweenHandlers()}},{key:"buildComponent",value:function(){var a=document.createElement("div");a.className="multihandle__track",this.container.appendChild(a),this.findInputs(),a.innerHTML=this.options.tpl.track.replace(/\${handlers}/,this.createHandlers()),this.findHandlers(a),this.createIntervals(a),this.isItSnaps()&&(this.snappingMap=this.createSnappingMap(),this.options.gfx.indexOf("snappingpoints")>-1&&this.createSnappingPoints(a)),this.container.appendChild(a)}},{key:"bindEvents",value:function(){var a=this;this.container.addEventListener("mousedown",function(b){return a.onMouseDown(b)}),this.container.addEventListener("touchstart",function(b){return a.onMouseDown(b)}),document.body.addEventListener("mouseup",function(b){return a.onMouseUp(b)}),document.body.addEventListener("touchend",function(b){return a.onMouseUp(b)}),document.body.addEventListener("touchcancel",function(b){return a.onMouseUp(b)}),document.body.addEventListener("mousemove",function(b){return a.onMouseMove(b)}),document.body.addEventListener("touchmove",function(b){return a.onMouseMove(b)}),this.handlerEls.forEach(function(b){b.addEventListener("keydown",function(b){return a.onHandlerKeyDown(b)}),b.ondragstart=function(a){return!1}})}},{key:"onMouseDown",value:function(a){var b=this.handlerEls.indexOf(a.target);b<0||(this.dragging={handlerIx:b,handler:this.handlerEls[b],startLeft:this.handlerEls[b].offsetLeft,startX:e(a)},this.dragging.handler.classList.add("multihandle__handle--active"),document.body.classList.add("multihandle-disable-drag"))}},{key:"onMouseUp",value:function(a){this.dragging&&this.dragging.handler.classList.remove("multihandle__handle--active"),this.dragging=!1,document.body.classList.remove("multihandle-disable-drag")}},{key:"onMouseMove",value:function(a){if(this.dragging&&this.dragging.handlerIx>-1){var b=this.dragging.startLeft-(this.dragging.startX-e(a)),c=this.normalizePercent(this.pixelToPercent(b));this.dataset?this.setDatasetAsPercent(this.dragging.handler,c):this.setValueAsPercent(this.dragging.handler,c)}}},{key:"setHandlerValue",value:function(a,b){b=this.normalizeValue(b);var c=this.valueToPercent(b);a.inputReference.value=b,a.inputReference.dispatchEvent(f("input")),this.setHandlerPos(a,c)}},{key:"setValueAsPercent",value:function(a,b){var c=this.percentToValue(b);this.setHandlerValue(a,c)}},{key:"setDatasetAsPercent",value:function(a,b){var c=this.percentToValue(b),d=this.dataset[c];this.setHandlerValue(a,d.value),console.log(d)}},{key:"onHandlerKeyDown",value:function(a){switch(a.keyCode){case 38:this.incByBig(a.target),a.preventDefault();break;case 40:this.descByBig(a.target),a.preventDefault();break;case 39:this.incByLittle(a.target),a.preventDefault();break;case 37:this.descByLittle(a.target),a.preventDefault()}}},{key:"incByLittle",value:function(a){this.setHandlerValue(a,parseFloat(a.inputReference.value,10)+this.options.incLittle)}},{key:"descByLittle",value:function(a){this.setHandlerValue(a,parseFloat(a.inputReference.value,10)-this.options.incLittle)}},{key:"incByBig",value:function(a){this.setHandlerValue(a,parseFloat(a.inputReference.value,10)+this.options.incBig)}},{key:"descByBig",value:function(a){this.setHandlerValue(a,parseFloat(a.inputReference.value,10)-this.options.incBig)}},{key:"syncHandlersToInputs",value:function(){var a=this;a.handlerEls.forEach(function(b){var c=parseFloat(b.inputReference.value,10),d=a.valueToPercent(c);b.style.left=d+"%",b.innerHTML=b.innerHTML.replace(/\${value}/,c)})}},{key:"syncInputsToHandlers",value:function(){var a=this;this.handlerEls.forEach(function(b){var c=b.inputReference;c.value=a.percentToValue(parseFloat(b.style.left,10))})}},{key:"syncIntervalsBetweenHandlers",value:function(){this.handlerEls.length<2||this.intervals.forEach(function(a){var b=parseFloat(a.to.style.left,10),c=parseFloat(a.from.style.left,10),d=Math.min(b,c),e=Math.abs(b-c);a.style.left=d+"%",a.style.width=e+"%"})}},{key:"valueToPercent",value:function(a){var b=this.options.max-this.options.min;return 100/b*(a-this.options.min)}},{key:"pixelToPercent",value:function(a){var b=this.container.scrollWidth;return a/b*100}},{key:"percentToIndex",value:function(a){var b=this.options.max-this.options.min,c=a/(100/b);return c}},{key:"percentToValue",value:function(a){var c=(this.options.max-this.options.min,this.percentToIndex()+this.options.min),d=b(c,this.options.step);return d}},{key:"normalizePercent",value:function(a){return a=Math.max(0,a),a=Math.min(100,a),this.valueToPercent(this.percentToValue(a))}},{key:"normalizeValue",value:function(a){return a=Math.max(this.options.min,a),a=Math.min(this.options.max,a),a=c(a,this.options.decimalsAccuracy)}}]),a}(),h=function(a){a instanceof NodeList&&(a=Array.prototype.slice.call(a)),a instanceof Array||(a=[a]),a.forEach(function(a){return new g(a)})};a.multihandle=g,a.multihandle={init:h}}(window);